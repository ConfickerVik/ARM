{% extends 'cabinet/layout.html' %}

{% block content %}
    <h1 class="display-4">Студенты</h1>
    <div class="input-group mb-2">
        <select class="custom-select" id="select_course">
          <option value="" hidden>Курсы</option>
          {% for course in courses %}
            <option value="{{course.id_course}}">{{course.name}}</option>
          {% endfor %}
        </select>
        <select class="custom-select" id="select_group">
            <option value="" hidden>Группа</option>
            {% for group in groups %}
            <option value="{{group.name}}">{{group.name}}</option>
            {% endfor %}
          </select>
        <div class="input-group-append">
          <button id="showStudentsMarks" class="btn btn-success" type="button">Показать</button>
        </div>
      </div>
    <table style="font-size:1.2rem" class="table table-striped table-hover table-dark m-0">
        <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">ФИО</th>
                {% for les in lessons %}

                    {% if les.type == 'лек' or les.type == 'Лекция' %}
                    <th scope="col">{{les.date}}<span id="lecTag">{{les.type}}</span></th>
                    {% elif les.type == 'лаб' %}
                    <th scope="col">{{les.date}}<span id="labTag">{{les.type}}</span></th>
                    {% else %}
                    <th scope="col">{{les.date}}<span id="semTag">{{les.type}}</span></th>
                    {% endif %}

                {% endfor %}
            </tr>
        </thead>
        <tbody id="studentsTable"> 
            {% for key, value in marksStudents.items %}
            <tr>
                <th scope="row">{{ forloop.counter }}</th>
                <td>{{value.lastname_stud}} {{value.firstname_stud}} {{value.middlename_stud}}</td>
                {% for mark in value.marksEstimation %}
                <td>
                    <div class="input-group">
                        <input  type="checkbox" style="width:40px; height:40px;">
                        <select onchange= "changeMark( {{mark.id_estimation}}, {{mark.id_student}}, {{mark.id_lesson}}, '{{mark.date}}', this)" class="custom-select">
                            {% if mark.estimation == '1' %}
                                <option value="" hidden>Оценка</option>
                                <option selected value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                            {% elif mark.estimation == '2' %}
                                <option value="" hidden>Оценка</option>
                                <option value="1">1</option>
                                <option selected value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                            {% elif mark.estimation == '3' %}
                                <option value="" hidden>Оценка</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option selected value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                            {% elif mark.estimation == '4' %}
                                <option value="" hidden>Оценка</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option selected value="4">4</option>
                                <option value="5">5</option>
                            {% elif mark.estimation == '5' %}
                                <option value="" hidden>Оценка</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option selected value="5">5</option>
                            {% else %}
                                <option value="" hidden>Оценка</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                            {% endif %}
                          </select>
                    </div>
                </td>
                {% endfor %}
            </tr>
        {% endfor %}
        </tbody>
    </table>
    
<script>
    $('#showStudentsMarks').click(()=>{
        let selectGroup = $('#select_group').val()
        let selectCourse =$('#select_course').val()
        
        location.replace(`/cabinet/students/${selectCourse}&${selectGroup}`)
    })
	
	
<<<<<<< HEAD
function changeMark(id_estimation, id_student, id_lesson, mark){

    alert(id_estimation)
    alert(id_student)
    alert(id_lesson)
    alert(mark.value)

    // $.ajax({
    //   type: 'POST',
    //   data: {
    //     'csrfmiddlewaretoken': '{{ csrf_token }}',
    //     'typeAction': 'changeMark',
    //     'id_estimation': id_estimation,
    //     'id_student': id_student,
    //     'id_lesson': id_lesson,
    //   },
    //   success: function () {
    //     'Посещалка поменялась'
    //   },
    // });
=======
function changeMark(id_estimation, id_student, id_lesson, time_date, mark){
    //alert(id_estimation)
    //alert(id_student)
    //alert(id_lesson)
    //alert(mark.value)
    $.ajax({
      type: 'POST',
      data: {
        'csrfmiddlewaretoken': '{{ csrf_token }}',
        'typeAction': 'changeMark',
        'time_date': time_date,
        'id_estimation': id_estimation,
        'id_student': id_student,
        'id_lesson': id_lesson,
        'mark':mark.value
      },
      success: function (data) {
        location.reload()
      },
    });
>>>>>>> 6fed1c6da23657b80b2c4d9a8d5dd8176bd16a6c
}
</script>

{% endblock %}